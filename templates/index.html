{% extends "base.html" %}
{% set active_page = "index" %}

{% block content %}
<div class="container">
  <form id="upload-file" method="post" enctype="multipart/form-data">
    <fieldset>
      <label for="file">Select a file</label>
      <input name="file" type="file">
    </fieldset>
    <fieldset>
      <button type="button" class="btn btn-primary">Click me, I make stuff happen (check console doe)</button>
    </fieldset>
    <div class="progress progress-striped active hide">
      <div class="progress-bar progress-bar-info" id='realtime-progress-bar' role="progressbar" style="width: 0%"></div>
    </div>
    <p class="messages"></p>
  </form>
</div>
<script type="text/javascript">
  var pusher = new Pusher('{{ pusher_key }}', {
    encrypted: true
  });
  var channel = pusher.subscribe('{{ session_id }}');

  channel.bind('my-event', function(data) {
    console.log(data.message);
    var messageBox = $('#upload-file').children('.messages')
    var progressBar = $('#realtime-progress-bar')

    progressBar.width(data.progress+"%")
    messageBox.html(data.message)

    // The process is complete: do whatever you want now, maybe redirect them to their newly created account?
    if (data.progress == 100) {
      messageBox.html()
    }
  });
</script>
{% endblock %}