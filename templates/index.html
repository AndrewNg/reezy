{% extends "base.html" %}
{% set active_page = "index" %}


{% block content %}
<div class = "container">
  <div class="contents">
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <h1> {reezy} </h1>
    <br>
    <br>
  </div>
  <div class="contents" align="center">
    <form id="upload-file" method="post" enctype="multipart/form-data">
      <fieldset>
        <label for="file">Upload a PDF to get a summarized audio file!</label>
        <input name="file" type="file">
      </fieldset>
      <fieldset>
        <form>
          How long should your summary be?
          <input type="text" value="30 seconds" name="length">
        </form>
        <br>
        <br>
      </fieldset>
      <fieldset>
        <button type="button" class="btn button btn-primary" style="background-color:#800020">Get summarized audio</button>
      </fieldset>
      <div class="progress progress-striped active hide">
        <div class="progress-bar progress-bar-info" id='realtime-progress-bar' role="progressbar" style="width: 0%"></div>
      </div>
      <p class="messages"></p>
    </form>
  </div>
  <br>
  <br>
  <br>
  <br>
  <br>
  <div class="foot" align="center">
    <p><a href="index">Home</a> &middot <a href="about">About</a> &middot <a href="status">Status</a></p>
  </div>
</div>

<script type="text/javascript">
  var pusher = new Pusher('{{ pusher_key }}', {
    encrypted: true
  });
  var channel = pusher.subscribe('{{ session_id }}');

  channel.bind('my-event', function(data) {
    console.log(data.message);
    var messageBox = $('.messages')
    var progressBar = $('#realtime-progress-bar')

    progressBar.width(data.progress+"%")
    messageBox.html(data.message)

    // The process is complete: do whatever you want now, maybe redirect them to their newly created account?
    if (data.progress == 100) {
      // we'll do something here in the future
    }
  });
</script>


{% endblock %}